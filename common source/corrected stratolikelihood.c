/* 	top: observed first appearance of taxon or hypothesized divergence of descendants	base: hypothesized origin of range extension	r: vector giving preservation rates in different intervals	vr: vector giving lognormal variation in preservation rates in different intervals******************************************************************************************/	double stratlikelihoodbranch(double top, double base, double *r, double *vr){int a, b, c, d;double	t;double	x, y, z;double	divisions[4];double L=0.0f, lnL=0.0f;a=0.5+top;			/* bin of observed first appearance; note that bins go from .00 to 0.9999É		*/b=1+base;		/* bin of hypothesized origin; note that bins go from .00 to 0.9999É			*//* these are the divisions of a normal curve giving midpoints of 4 equal area units	*/divisions[0]=-1.150349380;divisions[1]=-0.318639364;divisions[2]=0.318639364;divisions[3]=1.150349380;/* go through each bin (c) from first appearance (a) to hypothesized origin (b)	*/for (c=a; c>=b; --c)	{	if (c==a && c>b)		t=top-((double) (c-1));		/* take into account partial presence in last "stage"	*/	else if (c==b && c<a)		t=((double) c)-base;		/* take into account partial presence in first "stage"	*/	else if (a==b)		t=top-base;				/* take into account partial presence in only "stage"	*/	else		t=1.0f;						/* presence in whole "stage"	*/	if (t>0)	{		L=0.0f;		for (d=0; d<4; ++d)	{			x=pow(vr[c],divisions[d]);	/* rate modifier at this point of lognormal	*/			y=x*r[c];					/* modified rate							*/			z=y*t;						/* expected finds							*/			L+=pow(e,-z);				/* probability of 0 finds at this rate		*/			}		L/=4;			/* take into account our 1 in 4 priors on the different preservation rates	*/		lnL+=log(L);	/* log it	*/		}	}return lnL;}/* 	top: observed first appearance of taxon or hypothesized divergence of descendants base: hypothesized origin of range extension r: vector giving a distribution of 4 equiprobable preservation rates in different intervals ******************************************************************************************/	double stratlikelihoodbranch2(double top, double base, double **r){	int a, b, c, d;	double	t;	double	x, y, z;	double L=0.0f, lnL=0.0f;		a=0.5+top;			/* bin of observed first appearance; note that bins go from .00 to 0.9999É		*/	b=1+base;		/* bin of hypothesized origin; note that bins go from .00 to 0.9999É			*/		/* go through each bin (c) from first appearance (a) to hypothesized origin (b)	*/	for (c=a; c>=b; --c)	{		if (c==a && c>b)			t=top-((double) (c-1));		/* take into account partial presence in last "stage"	*/		else if (c==b && c<a)			t=((double) c)-base;		/* take into account partial presence in first "stage"	*/		else if (a==b)			t=top-base;				/* take into account partial presence in only "stage"	*/		else			t=1.0f;						/* presence in whole "stage"	*/				if (t>0)	{			L=0.0f;			for (d=0; d<4; ++d)	{//				x=pow(vr[c],divisions[d]);	/* rate modifier at this point of lognormal	*///				y=x*r[c];					/* modified rate							*///				z=y*t;						/* expected finds							*/				L+=pow(e,-(r[c][0]*t));				/* probability of 0 finds at this rate		*/			}			L/=4;			/* take into account our 1 in 4 priors on the different preservation rates	*/			lnL+=log(L);	/* log it	*/		}	}	return lnL;}