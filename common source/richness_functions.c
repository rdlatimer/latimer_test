#define richness_functions#include "richness_functions.h"#include "memory.h"#include <stdlib.h>#include <stdio.h>/*FROM HURLBERT 1971 EQUATION 14 - E(Sn) = ·[1 - (1-¹i)^n]NEEDS:    - array with abundance distribution (*abundance)    - size of array (true richness, S)    - number of samples (n)RETURNS:    - expected number of sampled data at a given sampling intensity.*************************************************************/double Hurlbert(int n, double *abundance, int S)	{int	i;double	xx, ES=0;for (i=0; i<S; ++i)	{	xx=1-abundance[i];	xx=pow(xx,n);	xx=1-xx;	ES=ES+xx;	}return ES;}/*Which of two samples has greater sampled richness, given specimen samples, distribution and true richness?NEEDS:    - 2 arrays with abundance distribution (*abundance1, *abundance2)    - 2 size of array (S1, S2)    - size of desired sample (Nt).RETURNS:    - *************************************************************/int HurlComp(int Nt, double *abundance1, int S1, double *abundance2, int S2)	{/* E(Sn) = ·[1 - (1-¹i)^n] */int	a, n, N;double	xx, yy, X=0, Y=0;N=Nt+1;for (n=10; n<N; ++n)	{	X=Y=0;	for (a=0; a<S1; ++a)	{		xx=1-abundance1[a];		xx=pow(xx,n);		xx=1-xx;		X=X+xx;		}	for (a=0; a<S2; ++a)	{		yy=1-abundance2[a];		yy=pow(yy,n);		yy=1-yy;		Y=Y+yy;		}	if (Y>X)	{		N=n;		n=Nt+1;		}	}return N;}/*FROM Heck et al. 1975 EQUATION 4 - V(Sn) = ·([1 - {1-¹i}^n]*[1-{1-¹i}^n]) + 2·([1-¹i-¹j]^n)-([1-¹i]^n)*([1-¹j]^n)NOTE:  THIS EQUATION DOES NOT ACTUALLY WORK!!!!!!!NEEDS:    - array with abundance distribution (*p)    - size of array (true richness, S)    - number of samples (n)RETURNS:    - variance on expected sampled richness given abundance distribution and samples.*************************************************************/double HeckVar(int n, double *p, int S)	{int	i, j;double	x, xx, yy=0.0f,y,  VS=0.0f;/*var(Sn) = ·({(1-pi)^n * [1-(1-pi)^n]} + 2*·[{1-pi-pj}^n - {(1-pi)^n (1-pj)^n}])        = · xx + 2*yy*/	for (i=0; i<S; ++i)	{	x=pow((1-p[i]),n);		/* xx = (1-pi)^n	*/	xx=x*(1-x);	VS=VS+xx;	}for (j=1; j<S; ++j)	{	for (i=0; i<j; ++i)	{		y=(1-p[i])-p[j];		yy=yy+pow(y,n)-(pow((1-p[i]),n)*pow((1-p[j]),n));		}	VS=VS+(2*yy);	}return VS;}/*FROM Heck et al. 1975 EQUATION 2This is an approximation required because Heck et al.'s Equation 4 is wrongNEEDS:    - array with abundance distribution (*p)    - size of array (true richness, S)    - number of samples (n)RETURNS:    - variance on expected sampled richness given abundance distribution and samples.*************************************************************/double HeckVarApx(int n, double *p, int S)	{int	i, j;int	*Ni;double	x, xx, yy=0.0f,y,  VS=0.0f, N=0.0f;/*var(Sn) = ·{(1-pi)^n * [1-(1-pi)^n]} + 2*·[(1-pi-pj)^n * -(1-pi)^n (1-pj)^n]*/N=1.0/p[S-1];	/* Make N such that minimum Ni (Ni[S-1]) = 1 *//*Ni=ivector(S);	/* Vector with # specimens expected for each species */Ni = (int*)malloc(S * sizeof (int));for (i=0; i<S; ++i)	{	x=p[i]*N;	Ni[i]=x;	if (x-Ni[i] > 0.5)	++Ni[i];	}for (i=0; i<S; ++i)	{	x=pow((1-p[i]),n);		/* xx = (1-pi)^n	*/	xx=x*(1-x);		for (j=i+1; j<S; ++j)	{		y=(1-p[i])-p[j];		y=pow(y,n);		yy+=-1*y*(pow((1-p[i]),n)*pow((1-p[j]),n));		}	VS=VS+xx+(2*yy);	}return VS;}/*Which of two samples has greater sampled richness, given specimen samples, distribution and true richness?NEEDS:	Nt - the sample size;    - 2 arrays with abundance distribution (*abundance1, *abundance2)    - 2 size of array (S1, S2)RETURNS:    - *************************************************************/int HeckComp(int Nt, double *abundance1, int S1, double *abundance2, int S2)	{/* E(Sn) = ·[1 - (1-¹i)^n] */int	n, N;double	X=0.0f, Y=0.0f, sX, sY;N=Nt+1;for (n=10; n<N; ++n)	{	X=Y=0.0f;	X=Hurlbert(n,abundance1,S1);	Y=Hurlbert(n,abundance2,S2);	sX=HeckVar(n,abundance1,S1);	sY=HeckVar(n,abundance2,S2);	sX=pow(sX,0.5);	sY=pow(sY,0.5);	if ((Y+sY)>=(X-sX))	{		N=n;		n=Nt+1;		}	}return N;}