/* expectedfindsprop - finds the expected proportion of sampled taxa with 0...max finds given binomial probabilities, total finds and distribution/* Requires:		oct - an array giving the expected number of species with 1Én finds, with oct[1] giving E[species with 1 specimen];		S - the length of dist (i.e., richness);		mxfnds - the finds for the most common taxon; 		ttl - the number of unique sample numbers - this equals S+1 if all species have a unique number of samples, 2 if all are sampled 				X times (I am considering 0 to be one of the number of times sampled for likely unsampled species/* Returns:		expected - an array in which e[x] gives the expected number of species sampled x times	NOTE: sometimes this is really slow - if the maximum number of finds is really high, then use expectedfindspart and modify		routines accordingly.  ******************************************************************************************************************************************/double *expfindsfromoct (double *oct, int S, int mxfds, int ttl){int j, n, m, sp;double	ttlraw=0.0f;double *expected;double	lp=0.0000000f, lnc=0.0000000f, y=0.0000000f;expected=dvector(mxfds+1);/* find the total number of individuals - this is n x E[# of taxa with n specimens] summed over all specimen numbers	*/for (n=1; n<=mxfds; ++n)	ttlraw+=((double) n) * oct[n];/* For each possible number of finds (i.e., 0 to the maximum observed) calculate the expected number of species with n finds */for (n=0; n<=mxfds; ++n)	{	expected[n]=0;	/* calculate combinations in logarithms */	lnc=0.0000000f;	m=n;	if (m>(ttl-n))	m=ttl-n;	for (j=(ttl-m)+1; j<=ttl; ++j)	lnc=lnc+log(j);	for (j=2; j<=m; ++j)			lnc=lnc-log(j);	/*	for (sp=0; sp<S; ++sp)	{	*/	for (t=1; t<		y=1-dist[sp];		lp=lnc+((double)n)*log(dist[sp])+((double)(ttl-n)*log(y));		expected[n]=expected[n]+pow(e,lp);		}	if (expected[n]==0)	expected[n]=pow(10,-323);	/* this is about as low as you can go */		if (n>0)	expected[n]/=(((double) S) - expected[0]);	}return expected;}