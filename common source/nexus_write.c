#define nexus_write#include "nexus_write.h"#include <stdlib.h>#include <stdio.h>#include <time.h>#include <math.h>#include <string.h>#include <limits.h>				// needed for RAND_MAX calls//sFILE	*output;FILE *output;void open_output(char *outfile){output=fopen(outfile,"a");}void close_output(){fclose(output); }/****************************	START Tree Writing to a file ******************************//* input: 		tree: matrix where:			tree[x][0] gives number of taxa in clade x;			tree[x][1…n] give taxon numbers where:				0…n-1 are otus;				n…n+x are clades		node: clade number (this is a recursive routine)		notu: number of otus*******************************************************************************************/void write_nexus_file(long **tree, int node, int notu){int i, scion, sp;fprintf(output,"(");for (i=1; i<=tree[node][0]; ++i)	{	sp=tree[node][i];	if (sp<notu)	fprintf(output,"%d",sp+1);	else	{		fprintf(output,"(");		scion=sp-notu;		write_nexus_file(tree,scion,notu);		}	if (i<tree[node][0])	fprintf(output,",");	}fprintf(output,")");if (node==0)	fprintf(output,";\n");}/****************************	END Tree Writing to a file ******************************//****************************	START Tree Writing to a string ******************************//* input: 		tree: matrix where:			tree[x][0] gives number of taxa in clade x;			tree[x][1…n] give taxon numbers where:				0…n-1 are otus;				n…n+x are clades		node: clade number (this is a recursive routine)		notu: number of otus*******************************************************************************************/void write_nexus(long **tree, int node, int notu){int i, scion, sp;//if (node==0)	printf("(");printf("(");for (i=1; i<=tree[node][0]; ++i)	{	sp=tree[node][i];	if (sp<notu)	printf("%d",sp+1);	else	{//		printf("(\n");		scion=sp-notu;		write_nexus(tree,scion,notu);		}	if (i<tree[node][0])	printf(",");	}printf(")");if (node==0)	printf(";\n");}/****************************	Tree Writing to a string ******************************//* input: 		tree: matrix where:			tree[x][0] gives number of taxa in clade x;			tree[x][1…n] give taxon numbers where:				0…n-1 are otus;				n…n+x are clades		node: clade number (this is a recursive routine)		notu: number of otus*******************************************************************************************/void write_nexus_string(long **tree, int node, int notu, char *nexus, int *counter){int i, scion, sp, s, ss;char	a;if (node==0)	nexus[counter[0]]='(';++counter[0];for (i=1; i<=tree[node][0]; ++i)	{	s=sp=tree[node][i];	if (sp<notu)	{		if (sp>99)	{			s=(sp+1)%100;			sp-=s;			a='0'+(sp/100);			nexus[counter[0]]=a;			sp=s;			s=sp%10;			sp-=s;			a='0'+(sp/100);			nexus[++counter[0]]=a;			a='0'+s;			nexus[++counter[0]]=a;			}		/* make sure that this matches below! */		else if (sp>9)	{			s=(sp+1)%10;			ss=sp-(s-1);				/* 1st digit of 10, 20, 30, etc.	*/			a='0'+(ss/10);			nexus[counter[0]]=a;//			s=1+sp+-ss;					/* 2nd digit of 10, 21, 32, etc.	*/			a='0'+s;			nexus[++counter[0]]=a;			}		else	{			a='0'+(sp+1);			nexus[counter[0]]=a;			}		++counter[0];		}	else	{		nexus[counter[0]]='(';		++counter[0];		scion=sp-notu;		write_nexus_string(tree,scion,notu,nexus,counter);		}	if (i<tree[node][0])	{		nexus[counter[0]]=',';		++counter[0];		}	}nexus[counter[0]]=')';++counter[0];if (node==0)	{	nexus[counter[0]]=';';	nexus[++counter[0]]='\n';	}}